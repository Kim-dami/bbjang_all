<html lang="ko"><head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="true">
<meta name="mobile-web-app-capable" content="yes">
<meta name="format-detection" content="telephone=no">
<title>방부장</title>
<link rel="stylesheet" type="text/css" href="css/bb_default.css">
<link rel="stylesheet" type="text/css" href="css/bb_font.css">
<link rel="stylesheet" type="text/css" href="http://devm-kossy2k.bbjang.com/_global/assets/css/bb_pop.css?ver=1489364556"><link rel="stylesheet" type="text/css" href="css/bb_message.css">
<style>
#wrap .viewOrHide {display:none;}
body {background:#7abadd;}
#container .msg_btn_wrap {height:40px;top:0px;}
.msg_img {cursor:pointer}
.mg_top83 {margin-top:0px;padding-top:83px; }
</style>
<script type="text/javascript">
document.domain = 'bbjang.com';
</script>
</head>
<body><span id="connectionStatus" style="position:absolute; z-index:9000; top:0px; left:0px;">&nbsp;<b><font color="red" size="2">O</font></b></span><div id="msg_wrap" class="pd_50">
		<div id="header" class="ht_45 bg_white header_f">
		<div class="btn_back">
			<a href="javascript:void(0);" onclick="cl.goBack()">뒤로</a>
		</div>
		<h1 class="header_txt font_b">상세정보</h1>
	</div>	<div id="container">
		<!-- 상세메시지 버튼바 -->
		<div class="msg_btn_wrap header_f mg_top45">
			<ul class="font_r">
				<li><a href="javascript:void(0);" onclick="location.replace('/msgBox/msgList/');">대화함</a></li>
				<li><a href="javascript:void(0);" onclick="msgDel();">삭제</a></li>
				<li><a href="javascript:void(0);" onclick="myArticle();">+ 내 매물 소개</a></li>
			</ul>
		</div>
		<!-- // 상세메시지 버튼바 -->
	</div>
	<!-- 리스트 시작 -->
	<div id="msg_content_warp" class="pd_50 mg_top83">
	<div id="lodingMore" class="load_wrap" style="display: none;">
		<img src="http://image.bbjang.com/imgs/bbjang/img01/loading_white.gif" width="25px" height="25px" alt="로딩이미지">
	</div>
	
		<div class="msg_day_wrap" id="dayArea20170313">
			<div class="msg_day_line font_r" id="dayView20170313">
				<p>
					 2017년 03월 13일
				</p>
			</div>
			<div id="my_msg" class="msg_bubble_wrap">
				<!-- 메시지 내용 -->
				<div class="talkbubble_wrap my_bubble_warp">
					<div class="my_talkbubble font_r">
								<ul class="sell_ptn">
									<li><img src="http://image.bbjang.com/imgs/bbjang/img01/img_msg_sell_logo.png" width="87" height="30" class="bbj_logo"></li>
									<li><span class="font_b">월세 | </span><span>9만/9만</span></li>
									<li><span>111</span></li>
									<li><a href="javascript:void(0);" onclick="cl.openWin('/dealconts/dealView/?bangNo=2137&amp;memNo=22', 'bangconts');">매물정보보기&nbsp; <img src="http://image.bbjang.com/imgs/bbjang/img01/img_msg_sell_arrow.png" width="9" height="14"></a></li>
								</ul>
					</div>
					<span class="my_talk_time_none font_r">오전 09:22</span>
					<!-- 내 메시지 시간 "my_talk_time:before" content 에 읽음 안읽음 표현 -->
				</div>
			</div>
			<div id="my_msg" class="msg_bubble_wrap">
				<!-- 메시지 내용 -->
				<div class="talkbubble_wrap my_bubble_warp">
					<div class="my_talkbubble font_r">
								ddd
					</div>
					<span class="my_talk_time_none font_r">오전 09:22</span>
					<!-- 내 메시지 시간 "my_talk_time:before" content 에 읽음 안읽음 표현 -->
				</div>
			</div>
			<div id="my_msg" class="msg_bubble_wrap">
				<!-- 메시지 내용 -->
				<div class="talkbubble_wrap my_bubble_warp">
					<div class="my_talkbubble font_r">
								sssss
					</div>
					<span class="my_talk_time_none font_r">오전 09:22</span>
					<!-- 내 메시지 시간 "my_talk_time:before" content 에 읽음 안읽음 표현 -->
				</div>
			</div>
			<div id="ptn_msg" class="msg_bubble_wrap">
				<div class="photo_ptn">
					<img src="http://photo.bbjang.com/prg/bbImg.php?type=profile&amp;sdir=&amp;viewname=aXuteH-DfIhWamljbHuAdoCxp4aOqZo." width="74" height="74" alt="상대사진">
				</div>
				<div class="ptn_txt_line font_r">
					<span class="ptn_txt">고성수</span>
				</div>
				<div class="talkbubble_wrap ptn_bubble_wrap">
					<div class="ptn_talkbubble font_r">
								ggg
					</div>
					<span class="ptn_talk_time font_r">
					  오전 09:22
            <a href="javascript:void(0);" onclick="reportMsg('4437','22','ggg','|');" class="btn_msg_report"></a>  <!-- 신고버튼 추가 -->
          </span>
				</div>
			</div>
		</div>
<div id="msgEnd"></div>
	<div id="photoArea" nowview="0"></div>
	</div>
	<!-- 메시지 입력창 -->
	<div class="msg_input_wrap">
		<div class="msg_bar">
			<ul class="msg_text_box">
				<li>
				<a href="javascript:void(0);" onclick="photoSend();" class="btn_camera"><img src="http://image.bbjang.com/imgs/bbjang/img01/ico_msg_photo.png" width="20" height="17" alt="사진전송"></a>
				<!-- 사진 첨부 -->
				</li>
				<li>
				<input type="text" class="textarea" id="sendConts" value="">
				<!-- 글쓰기 -->
				</li>
				<li>
				<a href="javascript:void(0);" onclick="msgSend();" class="btn_send">전송</a>
				<!-- 전송 버튼 -->
				</li>
			</ul>
		</div>
	</div>
	<!-- // 메시지 입력창 -->
</div>
<div id="popArticle"></div>
<div id="popForm"></div>
<div id="popEvent"></div>
<div id="popToast"></div>
<div id="popPhoto"></div>
<div id="popRcvMsg"></div>
<script type="text/javascript" src="http://devm-kossy2k.bbjang.com/_global/assets/js/jquery-2.2.4.min.js"></script>
<script type="text/javascript" src="http://devm-kossy2k.bbjang.com/_global/assets/js/jquery-cookie.js"></script>
<script type="text/javascript" src="http://devm-kossy2k.bbjang.com/_global/assets/js/common.js?ver=1489364556"></script>

<script type="text/javascript">
var $daumApiKey = 'b3c229665be60525d0cd32435537931d'; 
var $kkoApiKey = '523a36eacc6bc0551caf4d6a2b1f3f12';
var $appLink = 'http://goo.gl/';
var $shareMinImg = 'http://image.club5678.com/imgs/bbjang/img_mms/mms_bbjang_185_185.jpg';
var $shareBigImg = 'http://image.club5678.com/imgs/bbjang/img_mms/mms_bbjang_300_200.jpg';

var $COORDS = cl.setGeo();
var $isMobile = cl.isMobile();
var $device = cl.getDevice();
var $media = ($isMobile) ? ($device) ? 's' : 'x' : 'w';
var $platform = cl.getPlatform();
var $isApp = ($device) ? true : false;
var $isReal = 1;
var $gJsUrl = "http://devm-kossy2k.bbjang.com/_global/assets/js";
var $vJsUrl = "http://devm-kossy2k.bbjang.com/assets/js";
var $vUiUrl = "http://devm-kossy2k.bbjang.com/assets/ui";
var $gJsVer = "1489364556";
var isDebug = function() {
	return true;
}
</script>
<script type="text/javascript" src="http://devm-kossy2k.bbjang.com/_global/assets/js/sessionPacketRouter.js?ver=1489364556"></script>
<script type="text/javascript" src="http://devm-kossy2k.bbjang.com/_global/assets/js/NodeBangSession.js?ver=1489364556"></script>
<script type="text/javascript" src="http://devm-kossy2k.bbjang.com/_global/assets/js/jquery-ui.min-1.12.1.js"></script>
<script type="text/javascript" src="http://devm-kossy2k.bbjang.com/_global/assets/js/jquery-mobile.event.min.js"></script>
<script type="text/javascript">
<!--
$(document).on("ready",function(){
	cl.srchReloadList();
	var locName = window.location.pathname+window.location.search;
	localStorage.setItem("setWindowPathName",locName);
	$(window).on("focus",function(){
		localStorage.setItem("setWindowPathName",locName);
		var noReadCnt = localStorage.getItem("msgCnt");

		if(localStorage.getItem("forceLogout") == '1') {
			localStorage.setItem("forceLogout", '');
			window.location.replace('/member/info/logout');
		}

		if(cl.srchReloadList()){
			window.location.reload();
		}else if(window.location.pathname=="/" && typeof badgeReset == "function"){
			badgeReset();
		}

		if(location.pathname == '/'){
			cl.msgCntUpd();
		}
	});

	$(window).on("popstate",function(){
		cl.popState();
	});

	$(window).on("unload",function(){
		//if(cl.subWin!==true) cl.clearAllWin({cmd:"closeWinPause"});
		cl.setLayerPopCnt();
	});

	$(window).on("load",function(){
		cl.subWin();
		if($.cookie('gCCV:NO')) cl.userBlockChk();
		cl.delLayerPopCnt();

				if($.cookie('setAutoLogin')) {
						$.cookie('setAutoLogin',$.cookie('setAutoLogin'),{expires:24*30, path:'/', domain:'.bbjang.com'});		}
				
	});
});
//-->
</script><script type="text/javascript" src="http://devm-kossy2k.bbjang.com/assets/ui/uiCommon.js?ver=1489364556"></script>
<script type="text/javascript" src="http://devm-kossy2k.bbjang.com/assets/ui/uiNotice.js?ver=1489364556"></script><script type="text/javascript" src="http://devm-kossy2k.bbjang.com/assets/js/contsComm.js?ver=1489364556"></script>
<script type="text/javascript" src="http://devm-kossy2k.bbjang.com/assets/ui/uiSingo.js?ver=1489364556"></script>
<script type="text/javascript" src="http://devm-kossy2k.bbjang.com/assets/ui/uiUpload.js?ver=1489364556"></script>
<script type="text/javascript" src="http://devm-kossy2k.bbjang.com/assets/ui/uiPhotoView.js?ver=1489364556"></script>
<script async="" type="text/javascript" src="http://devm-kossy2k.bbjang.com/_global/assets/js/handlebars-4.0.6.min.js"></script>
<script type="text/javascript" src="http://devm-kossy2k.bbjang.com/assets/js/util.js"></script>
<script type="text/javascript">

$(document).on("ready",function(){
	
	var _bangNo = "2137";
	var _ptrMemNo = "22";
	var tmpl;
	var photoParam = new Array();
	var notReadCnt;
	
	getListProcAjax = function(_param){
		$.ajax({
			async: false,
			cache: false,
			type:"POST",
			url:"/msgBox/msgView/msgViewAjax",
			dataType:"json",
			data:_param,
			success: function(result){
				//console.log(result);
				var html = tmpl(result);
				if(result.totCnt == 0){
					//매물정보 ui를 보여준다.				
					$('#lodingMore').hide();
				}else{
					$('#lodingMore').hide();
					
					if(result.arPhotoList) {
						photoParam = result.arPhotoList;
						new photoView({'viewHeight':225, 'mngBtnView':false, 'cssHead':'dt'});
						g_photoView.photoParamPut(photoParam);						
					}
					
					if(result.notReadCnt && result.notReadCnt > 0) {
						notReadCnt = result.notReadCnt;
						cl.setAppNotReadCnt(notReadCnt);
					}
					/*
					for(var i=0;i<result.arList.length;i++){
						console.log(result.arList[i]);

						if(result.arList[i].msg_type > 0){
							var sendNo = result.arList[i].mem_no;
							var sendName = result.arList[i].mem_name;
							var sendPhotoUrl = "";
							var rcvNo = result.arList[i].ptr_mem_no;
						}else{
							var sendNo = result.arList[i].ptr_mem_no;
							var sendName = result.arList[i].ptr_mem_name;
							var sendPhotoUrl = result.arList[i].photoUrl;
							var rcvNo = result.arList[i].mem_no;
						}
						
						var printData = {"msg":result.arList[i].msg_cont,"fileInfo":result.arList[i].file_name,"msgImgUrl":result.arList[i].msgPhotoUrl,"msgSlct":result.arList[i].msg_slct,"sendNo":sendNo,"sendEtc":"","keyVal":result.arList[i].keyVal,"sendDate":result.arList[i].dateView,"sendMemPhotoUrl":sendPhotoUrl,"sendName":sendName,"sendTime":result.arList[i].msgTime,"rcvNo":rcvNo}
						msgPrint(printData);
					}
					*/
					//$("#msg_content_warp").prepend(html);
					$("#msgEnd").before(html);
					
					setTimeout(function(){
						var posVal = $("#msgEnd").offset();
						$('html,body').scrollTop(posVal.top);						
					},225);
					setTimeout(msgScroll,450);
				}
			},
			error: function(xhr,status,error){
				cl.ajaxErr(xhr.responseText);
			}
		});
	}
		
	getList = function(){
		this.pageStop = false;
		this.page  = 1;
		this.listProc = function(){
			if(!this.pageStop){
				var param = {"bangNo":_bangNo,"pmemNo":_ptrMemNo,"pageNo":this.page,"pagePerCnt":600};
				getListProcAjax(param);
			}
		}
	};	

	// 허위매물신고(class.controls.dealView에서 호출)
	reportMsg = function(_autoNo, _ptrMemNo, _msg, _photoUrl){
		var singoParam = {
			'singoType' : UI_SINGO_TYPE_MESSAGE,
			'targetMemNo' : _ptrMemNo,
			'btn1CallBack' : null,
			'btn2CallBack' : null,
			'singoNo' : _autoNo,
			'msg' : _msg,
			'fileName' : _photoUrl,
		};
		//console.log(singoParam);
		var popupSingoEx = new CSingoEx(singoParam);
	};

	uploadFinish = function (_param) {
		//console.log(_param);
		if(_param.retCode == "1"){
			var arImgInfo = _param.imgInfo.split('|');
			//console.log(_param.imgInfo.split("|"));
			var data = {
				'bangNo' : _bangNo,
				'pmemNo' : _ptrMemNo,
				'msgSlct' : '2', // 0:text,1:이모티콘,2:파일,3:전화,4:영상통화,5:매물소개
				'msgCont' : '',
				'msgEtc' : '',
				'fileName':arImgInfo[0],
				'fileSize':arImgInfo[1] + '|' + arImgInfo[2]
			};
			
			//console.log(data);
			if(localStorage.newMsgChk){
				beforeSend();
				setTimeout(function(){
					cl.sendMsg(data);
				},300);
			}else{
				cl.sendMsg(data);
			}
		}else{
			new CToastEx({"msg":"사진 전송이 실패했습니다.<br/>잠시 후 다시 시도해 주세요","elapse":2000});
		}
	}

	photoSend = function () {
		if(_ptrMemNo == "1"){
			new CToastEx({"msg":"운영자에게는 1:1문의하기로<br/> 연락하실 수 있습니다.","elapse":2000});
		}else{
			g_upload.addPhoto();
			//m_commLoading.start();
		}
	}
	
	cvtTag = function (_str){
		_str = _str.replace(/</g,"&lt;");
		_str = _str.replace(/>/g,"&gt;");
		_str = _str.replace(/\"/g,"&quot;");
		_str = _str.replace(/\'/g,"&#39;");
		//_str = _str.replace(/\"/g,"");
		//_str = _str.replace(/\'/g,"");		
		_str = _str.replace(/\n/g," ");
		return _str;
	}

	msgSend = function () {
		if(_ptrMemNo == "1"){
			new CToastEx({"msg":"운영자에게는 1:1문의하기로<br/> 연락하실 수 있습니다.","elapse":2000});
		}else{
			var sendConts = $('#sendConts').val();
			if($.trim(sendConts).length > 100){new CToastEx({"msg":"100자까지 입력가능합니다","elapse":2000});return}
			if($.trim(sendConts).length < 1){new CAlertEx({msg:"메시지 내용을 입력해 주세요",btnCallback:function(){$("#sendConts").focus();}});return;}
			
			var data = {
				'bangNo' : _bangNo,
				'pmemNo' : _ptrMemNo,
				'msgSlct' : '0', // 0:text,1:이모티콘,2:파일,3:전화,4:영상통화,5:매물소개
				'msgCont' : cvtTag(sendConts),
				'msgEtc' : '',
				'fileName':'',
				'fileSize':''
			};			
			if(localStorage.newMsgChk){
				beforeSend();
				setTimeout(function(){
					cl.sendMsg(data);
				},300);
			}else{
				cl.sendMsg(data);
			}
			$('#sendConts').val("").focus();
		}
	}

	beforeSend = function () {
		var arBangInfo = localStorage.newMsgChk.split('|');
		var beforeData = {
			'bangNo' : arBangInfo[0],
			'pmemNo' : _ptrMemNo,
			'msgSlct' : '5', // 0:text,1:이모티콘,2:파일,3:전화,4:영상통화,5:매물소개
			'msgCont' : '매물소개',
			'msgEtc' : '',
			'fileName':'',
			'fileSize':''
		};
		localStorage.removeItem("newMsgChk");
		cl.sendMsg(beforeData);
	}


	msgDel = function () {
		new CConfirmEx({
			msg : "메시지를 모두 삭제하시겠습니까?",
			btn2Callback : function(){
				var postData = {'ptrMemNos':_ptrMemNo + ','};
				$.ajax({
					async: false,
					cache: false,
					type:"POST",
					url:"/msgBox/msgList/msgDelAjax",
					dataType:"json",
					data:postData,
					success: function(result){
						$("#msg_content_warp").empty().append('<div id="msgEnd"></div>');
						new CToastEx({"msg":"삭제되었습니다.","elapse":2000});
					},
					error: function(xhr,status,error){
						cl.ajaxErr(xhr.responseText);
					}
				});				
			}
		});	
	}

	msgPrint = function (_param) {
		//console.log(_param);
		var msgPrintTag = new Array();
		var msgConts = (_param.msg) ? cvtTag(_param.msg) : '';
		
		if(_param.fileInfo && _param.msgImgUrl && _param.msgSlct == "2"){
			var photoIndex = photoParam.length;
			photoParam[photoIndex] = {"imgInfo":_param.fileInfo, "oImgUrl":_param.msgOrgImgUrl, "photoNo":photoIndex};
			if(!g_photoView || g_photoView === null)	new photoView({'viewHeight':225, 'mngBtnView':false, 'cssHead':'dt'});
			g_photoView.photoParamPut(photoParam);			
			
			var arImgInfo = _param.fileInfo.split('|');
			if(parseInt(arImgInfo[1]) > parseInt(arImgInfo[2])) msgConts = '<img src="' + _param.msgImgUrl + '" width="280" height="auto" class="msg_img" photoIndex="' + photoIndex + '" onclick="msgPhotoView(' + photoIndex + ');">';
			else msgConts = '<img src="' + _param.msgImgUrl + '" width="auto" height="280" class="msg_img" photoIndex="' + photoIndex + '" onclick="msgPhotoView(' + photoIndex + ');">';
		}

		if(_param.msgSlct == "3"){
			var addMent = '신청';
			if(_param.sendNo == _ptrMemNo) var addMent = '수신';
			msgConts = '<span class="call_phone_on font_b">전화상담 &nbsp; &gt;</span>';
		}		
		
		if(_param.msgSlct == "4"){
			var addMent = '신청';
			if(_param.sendNo == _ptrMemNo) var addMent = '수신';
			msgConts = '<span class="call_video_on font_b">영상상담 &nbsp; &gt;</span>';
		}				
		
		if(_param.sendEtc && _param.msgSlct == "5"){
			var arBangInfo = _param.sendEtc;
			var articleTag = new Array();
			
			var photoCSS = 'user_photo';
			if(arBangInfo.bangPhotoUrl == 'http://image.bbjang.com/imgs/bbjang/img01/img_msg_sell_logo.png') photoCSS = 'bbj_logo';
			//console.log(arBangInfo);

			articleTag.push('						<ul class="sell_ptn">');
			articleTag.push('							<li><img src="' + arBangInfo.bangPhotoUrl + '" width="87" height="30" class="' + photoCSS + '"></li>');
			
			if(arBangInfo.bangSlct == 'b') articleTag.push('							<li><span class="font_b">구해요 | </span><span>' + arBangInfo.bangType + ' ' + arBangInfo.bangAmt + '</span></li>');
			else articleTag.push('							<li><span class="font_b">' + arBangInfo.bangType + ' | </span><span>' + arBangInfo.bangAmt + '</span></li>');

			articleTag.push('							<li><span>' + arBangInfo.bangName + '</span></li>');
			articleTag.push('							<li><a href="javascript:void(0);" onclick="cl.openWin(\'/dealconts/dealView/?bangNo=' + arBangInfo.bangNo + '&memNo=' + _param.sendNo + '\', \'bangconts\');">매물정보보기&nbsp; <img src="http://image.bbjang.com/imgs/bbjang/img01/img_msg_sell_arrow.png" width="9" height="14"></a></li>');
			articleTag.push('						</ul>');
			articleTag = articleTag.join('');
			msgConts = articleTag;
		}		
		
		//console.log($('.msg_day_line').length);
		
		//오늘일자의 메시지가 있는가
		var keyValName = 'dayArea' + _param.keyVal;
		if($('#' + keyValName).length < 1){
			msgPrintTag.push('		<div class="msg_day_wrap" id="dayArea' + _param.keyVal + '">');
			msgPrintTag.push('			<div class="msg_day_line font_r" id="dayView' + _param.keyVal + '">');
			msgPrintTag.push('				<p>');
			msgPrintTag.push('					' + _param.sendDate + '');
			msgPrintTag.push('				</p>');
			msgPrintTag.push('			</div>');
		}
		
		if(_param.sendNo == _ptrMemNo){
			msgPrintTag.push('			<div id="ptn_msg" class="msg_bubble_wrap">');
			msgPrintTag.push('				<div class="photo_ptn">');
			msgPrintTag.push('					<img src="' + _param.sendMemPhotoUrl + '" width="74" height="74" alt="상대사진">');
			msgPrintTag.push('				</div>');
			msgPrintTag.push('				<div class="ptn_txt_line font_r">');
			msgPrintTag.push('					<span class="ptn_txt">' + _param.sendName + '</span>');
			msgPrintTag.push('				</div>');
			msgPrintTag.push('				<div class="talkbubble_wrap ptn_bubble_wrap">');
			msgPrintTag.push('					<div class="ptn_talkbubble font_r">');
			msgPrintTag.push('						' + msgConts + '');
			msgPrintTag.push('					</div>');
			msgPrintTag.push('					<span class="ptn_talk_time font_r">');
			msgPrintTag.push('					  ' + _param.sendTime + '');
			msgPrintTag.push('            <a href="javascript:void(0);" onclick="reportMsg(\'' + _param.rcvMsgNo + '\' , \'' + _param.sendNo + '\' , \'' + _param.msg + '\' , \'' + _param.fileInfo + '\');" class="btn_msg_report"></a>');
			msgPrintTag.push('          </span>');
			msgPrintTag.push('				</div>');
			msgPrintTag.push('			</div>');
			
			//메시지 읽음 처리
			cl.callApi({"cmd":"message/updMsgNotReadAjax","rcvNo":_ptrMemNo});
		}else{
			msgPrintTag.push('			<div id="my_msg" class="msg_bubble_wrap">');
			msgPrintTag.push('				<div class="talkbubble_wrap my_bubble_warp">');
			msgPrintTag.push('					<div class="my_talkbubble font_r">');
			msgPrintTag.push('						 ' + msgConts + '');
			msgPrintTag.push('					</div>');
			msgPrintTag.push('					<span class="my_talk_time font_r">' + _param.sendTime + '</span>');
			msgPrintTag.push('				</div>');
			msgPrintTag.push('			</div>');
		}
		
		if($('#' + keyValName).length < 1){
			msgPrintTag.push('		</div>');
			msgPrintTag = msgPrintTag.join('');
			$('#msgEnd').before(msgPrintTag);		
		}else{
			msgPrintTag = msgPrintTag.join('');
			$('#' + keyValName).append(msgPrintTag);		
		}
		
		msgScroll();
	}

	msgReadOk = function(_param){
		//console.log(_param);
		if(_param.result==="1") $("#msg_content_warp").find(".my_talk_time").removeClass("my_talk_time").addClass("my_talk_time_none");
		$.ajax({type:"POST",url:"/msgBox/msgView/msgNotReadCntAjax",dataType:"json",
			success:function(_notReadCnt){
				localStorage.setItem('msgCnt', _notReadCnt);
			}
		});	
	};
	
	msgScroll = function(){
		var posVal = $("#msgEnd").offset();
		var moveVal = '' + posVal.top + 'px';		
		$('html,body').animate({scrollTop:moveVal},250);
		
		$("#msg_content_warp").find(".my_talk_time").css({'content':''});
	}

	msgPhotoView = function(_param){
		//console.log(_param);
		$("#photoArea").attr("nowView",_param);
		g_photoView.popPhotoView();
	}

	
	myArticle = function(){
		myArticle.page = 1;
		
		$('#popArticle').load('/views/mobile/msgBox/uiArticle.php', function(_response, _status, _xhr){
      if('success' != _status) { alert(_status); return;}
      
      cl.addHistory("myArticle");
      
 		  myArticle.listProc();
 		  
 		  /* 추후 페이지형태로 바뀌면
	    $('#articleList').on("scroll",function(){
	    	$listLayer = $('#articleList');
	    	if ($listLayer[0].scrollHeight - $listLayer.scrollTop() == $listLayer.outerHeight()){
    			myArticle.page++;
    			myArticle.listProc();
    		}else{
    			return;
    		}
	    });   		  
	    */
	    
	    $("input[name='pop_myArticleSel']").change(function() {
	    	var myArticleSel = $(this);
	    	setTimeout(function(){
	    		//console.log(myArticleSel.val());
	    		if(myArticleSel.length > 0){
	    			//현재상태를 확인
	    			var endSlct = myArticleSel.attr("endSlct");
	    			switch(endSlct){
	    				case "n":
				    		myArticle.cleanup();
								var data = {
									'bangNo' : myArticleSel.val(),
									'pmemNo' : _ptrMemNo,
									'msgSlct' : '5', // 0:text,1:이모티콘,2:파일,3:전화,4:영상통화,5:매물소개
									'msgCont' : '매물소개',
									'msgEtc' : '',
									'fileName':'',
									'fileSize':''
								};
								
								if(localStorage.newMsgChk){
									beforeSend();
									setTimeout(function(){
										cl.sendMsg(data);
									},300);
								}else{
									cl.sendMsg(data);
								}    		
	    				break;
	    				case "c":
	    					new CToastEx({"msg":"[기간만료]된 매물은 소개하실 수 없습니다","elapse":2000});
	    				break;
	    				case "y":
	    					new CToastEx({"msg":"[거래완료]된 매물은 소개하실 수 없습니다.","elapse":2000});
	    				break;
	    			}
	    		}
	    	},140);
	    });
    });

    myArticle.listProc = function(){
   		var articleParam = {"pmemNo" : $.cookie('gCCV:NO'), "pageNo" : myArticle.page, "pagePerCnt" : 50, "listMode" : "r"};
			$.ajax({
				async: false,
				cache: false,
				type:"POST",
				url:"/articlelist/main/articleListAjax",
				dataType:"json",
				data:articleParam,
				success: function(result){
					//console.log(result);
					if(result.total == 0){
						$('#lodingMoreArticle').hide();
						$("#noneList1").show();
						$("#noneList2").show();
					}else{
						$('#lodingMoreArticle').hide();
						$("#noneList1").hide();
						$("#noneList2").hide();

						$('#aricleCnt').html(result.retList.length);			
						
						arArticle = new Array();
						for(var i=0;i<result.retList.length;i++){
							//console.log(result.retList[i]);
							
							var disabled = '';
							if(result.retList[i].end_slct == 'y') disabled = 'disabled';
							
							var bangAmt = Util.setAmount(result.retList[i].bang_amt); // 보증금
							if(result.retList[i].bang_rent_amt != '0'){ // 월세
								var bangRentAmt = ' / '+Util.setAmount(result.retList[i].bang_rent_amt); 
							} else {
								var bangRentAmt = '';
							}
							bangPrice = bangAmt+bangRentAmt;							
							
							arArticle.push('			<li class="list_card">');
							
							var addCSS = '';
							if(result.retList[i].photoName){
								arArticle.push('			  <div class="list_photo_wrap">');
								arArticle.push('				  <a href="javascript:void(0);" class="' + result.retList[i].endMark + '"><img src="' + result.retList[i].photoName + '" alt="' + result.retList[i].regName + '"></a>');
								arArticle.push('			  </div>');
								addCSS = 'photo_pl';
							}
							
							arArticle.push('				<div class="list_intro">');
							arArticle.push('					<div class="msg_regi">');
							arArticle.push('						<div class="top_line ' + addCSS + ' mg_bt5">');
							arArticle.push('							<span class="' + result.retList[i].slctMark + '_badge">' + result.retList[i].regSlct + '</span><span class="intro_price font_b ft_navy">' + bangPrice + '</span>');
							arArticle.push('							' + result.retList[i].endSlct + '');
							arArticle.push('						</div>');
							arArticle.push('						<div class="mid_line2 ' + addCSS + ' mg_bt5">');
							arArticle.push('							<p class="intro_title font_b">');
							arArticle.push('							' + result.retList[i].regName + '');
							arArticle.push('							</p>');
							arArticle.push('							<p class="intro_txt font_r">');
							arArticle.push('							' + result.retList[i].insDate + ' ' + result.retList[i].insTime + '');
							arArticle.push('							</p>');
							arArticle.push('						</div>');
							arArticle.push('					</div>');
							arArticle.push('				</div>');
							arArticle.push('				<div class="msg_rdo">');
							arArticle.push('					<div class="rdo_wrap">');
							arArticle.push('						<input type="radio" class="rdo_input" name="pop_myArticleSel" value="' + result.retList[i].bang_no + '" endSlct="' + result.retList[i].end_slct + '" id="myArticleSel' + result.retList[i].bang_no + '">');
							arArticle.push('						<label for="myArticleSel' + result.retList[i].bang_no + '" class="rdo_msg"></label>');
							arArticle.push('					</div>');
							arArticle.push('				</div>');
							arArticle.push('			</li>');
						}
						
						arArticle = arArticle.join('');
						$("#articleList").append(arArticle);
						
						$('#articleList').css({'height': $(window).height() - 76 + 'px'});	
					}
				},
				error: function(xhr,status,error){
					cl.ajaxErr(xhr.responseText);
				}
			});
    }
    
    myArticle.cleanup = function(){
    	cl.delHistory();
    	$('#popArticle').empty();
    }
	}

	$(window).on("resize",function(){
		msgScroll();
	});

	$(window).on("scroll",function(){
		//if($(window).scrollTop() + $(window).height() < $(document).height()) return;
		if($(window).scrollTop() > 0) return;	
		if(!callList.pageStop){
			setTimeout(function(){
				if(!callList.pageStop){
					callList.page++;
					callList.listProc();
				}
			},200);
		}
	});

	$(window).on("load",function(){
		new CUpload({'type':'msg','photoCount':1,'callback':uploadFinish});		
		
		tmpl = Handlebars.compile($("#coupleList-template").html());

		if(typeof Handlebars=="object"){
			Handlebars.registerHelper("list", function(items, options){
				var out = "";
				if(items!==null) for(var i=0, l=items.length; i<l; i++) out = out + options.fn(items[i]);
				return out;
			});
		}

		callList = new getList();
		callList.page = 1;
		callList.listProc();
		
		$("#sendConts").keypress(function (event) {
				if (event.which === 13) {
						msgSend();
				}
	  });		
	  
	  
		cl.callApi({"cmd":"message/updMsgNotReadAjax","rcvNo":_ptrMemNo});
	});
});

//-->
</script>
<script id="coupleList-template" type="text/x-handlebars-template">
	{{#list arList}}
		{{#if dateViewS}}
		<div class="msg_day_wrap" id="dayArea{{keyVal}}">
			<div class="msg_day_line font_r" id="dayView{{keyVal}}">
				<p>
					 {{dateView}}
				</p>
			</div>
		{{/if}}
		{{#if msgType}}
			<div id="my_msg" class="msg_bubble_wrap">
				<!-- 메시지 내용 -->
				<div class="talkbubble_wrap my_bubble_warp">
					<div class="my_talkbubble font_r">
					{{#if msgPhotoUrl}}
            <img src="{{msgPhotoUrl}}" width="100" height="auto" class="msg_img" photoIndex="{{photoIndex}}" onclick="msgPhotoView({{photoIndex}});">
					{{else}}
						{{#if msgCallTime}}
							<span class="{{msgCallCSS}} font_b"{{#if msgCallScript}}onclick="{{msgCallScript}}" style="cursor:pointer">{{msgCallTime}} &nbsp; &gt;{{else}}>{{msgCallTime}}{{/if}}</span>
						{{else}}
							{{#if bangNo}}
								<ul class="sell_ptn">
									<li><img src="{{bangPhotoUrl}}" width="87" height="30" class="{{bangCSS}}"></li>
									{{#if bangBuyUi}}
									<li><span class="font_b">구해요 | </span><span>{{bangType}} {{bangAmt}}</span></li>
									{{else}}
									<li><span class="font_b">{{bangType}} | </span><span>{{bangAmt}}</span></li>
									{{/if}}
									<li><span>{{bangName}}</span></li>
									<li><a href="javascript:void(0);" onclick="cl.openWin('/dealconts/dealView/?bangNo={{bangNo}}&memNo={{ptr_mem_no}}', 'bangconts');">매물정보보기&nbsp; <img src="http://image.bbjang.com/imgs/bbjang/img01/img_msg_sell_arrow.png" width="9" height="14"></a></li>
								</ul>
							{{else}}	
								{{msgCont}}
							{{/if}}
						{{/if}}
					{{/if}}						 
					</div>
					<span class="{{#if notReadView}}my_talk_time{{else}}my_talk_time_none{{/if}} font_r">{{msgTime}}</span>
					<!-- 내 메시지 시간 "my_talk_time:before" content 에 읽음 안읽음 표현 -->
				</div>
			</div>
		{{else}}	
			<div id="ptn_msg" class="msg_bubble_wrap">
				<div class="photo_ptn">
					<img src="{{photoUrl}}" width="74" height="74" alt="상대사진">
				</div>
				<div class="ptn_txt_line font_r">
					<span class="ptn_txt">{{ptrName}}</span>
				</div>
				<div class="talkbubble_wrap ptn_bubble_wrap">
					<div class="ptn_talkbubble font_r">
					{{#if msgPhotoUrl}}
            <img src="{{msgPhotoUrl}}" width="100" height="auto" class="msg_img" photoIndex="{{photoIndex}}" onclick="msgPhotoView({{photoIndex}});">
					{{else}}
						{{#if msgCallTime}}
					<span class="{{msgCallCSS}} font_b" {{#if msgCallScript}}onclick="{{msgCallScript}}" style="cursor:pointer">{{msgCallTime}} &nbsp; &gt;{{else}}>{{msgCallTime}}{{/if}}</span>
						{{else}}
							{{#if bangNo}}
								<ul class="sell_ptn">
									<li><img src="{{bangPhotoUrl}}" width="87" height="30" class="{{bangCSS}}"></li>
									{{#if bangBuyUi}}
									<li><span class="font_b">구해요 | </span><span>{{bangType}} {{bangAmt}}</span></li>
									{{else}}
									<li><span class="font_b">{{bangType}} | </span><span>{{bangAmt}}</span></li>
									{{/if}}
									<li><span>{{bangName}}</span></li>
									<li><a href="javascript:void(0);" onclick="cl.openWin('/dealconts/dealView/?bangNo={{bangNo}}&memNo={{ptr_mem_no}}', 'bangconts');">매물정보보기&nbsp; <img src="http://image.bbjang.com/imgs/bbjang/img01/img_msg_sell_arrow.png" width="9" height="14"></a></li>
								</ul>
							{{else}}	
								{{msgCont}}
							{{/if}}
						{{/if}}
					{{/if}}	
					</div>
					<span class="ptn_talk_time font_r">
					  {{msgTime}}
            <a href="javascript:void(0);" onclick="reportMsg('{{auto_no}}','{{ptr_mem_no}}','{{msgCont}}','{{file_name}}|{{file_size}}');" class="btn_msg_report"></a>  <!-- 신고버튼 추가 -->
          </span>
				</div>
			</div>
		{{/if}}
		{{#if dateViewE}}			
		</div>
		{{/if}}
	{{/list}}
</script>

<span style="border-radius: 3px; text-indent: 20px; width: auto; padding: 0px 4px 0px 0px; text-align: center; font-style: normal; font-variant: normal; font-weight: bold; font-stretch: normal; font-size: 11px; line-height: 20px; font-family: &quot;Helvetica Neue&quot;, Helvetica, sans-serif; color: rgb(255, 255, 255); background: url(&quot;data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzBweCIgd2lkdGg9IjMwcHgiIHZpZXdCb3g9Ii0xIC0xIDMxIDMxIj48Zz48cGF0aCBkPSJNMjkuNDQ5LDE0LjY2MiBDMjkuNDQ5LDIyLjcyMiAyMi44NjgsMjkuMjU2IDE0Ljc1LDI5LjI1NiBDNi42MzIsMjkuMjU2IDAuMDUxLDIyLjcyMiAwLjA1MSwxNC42NjIgQzAuMDUxLDYuNjAxIDYuNjMyLDAuMDY3IDE0Ljc1LDAuMDY3IEMyMi44NjgsMC4wNjcgMjkuNDQ5LDYuNjAxIDI5LjQ0OSwxNC42NjIiIGZpbGw9IiNmZmYiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLXdpZHRoPSIxIj48L3BhdGg+PHBhdGggZD0iTTE0LjczMywxLjY4NiBDNy41MTYsMS42ODYgMS42NjUsNy40OTUgMS42NjUsMTQuNjYyIEMxLjY2NSwyMC4xNTkgNS4xMDksMjQuODU0IDkuOTcsMjYuNzQ0IEM5Ljg1NiwyNS43MTggOS43NTMsMjQuMTQzIDEwLjAxNiwyMy4wMjIgQzEwLjI1MywyMi4wMSAxMS41NDgsMTYuNTcyIDExLjU0OCwxNi41NzIgQzExLjU0OCwxNi41NzIgMTEuMTU3LDE1Ljc5NSAxMS4xNTcsMTQuNjQ2IEMxMS4xNTcsMTIuODQyIDEyLjIxMSwxMS40OTUgMTMuNTIyLDExLjQ5NSBDMTQuNjM3LDExLjQ5NSAxNS4xNzUsMTIuMzI2IDE1LjE3NSwxMy4zMjMgQzE1LjE3NSwxNC40MzYgMTQuNDYyLDE2LjEgMTQuMDkzLDE3LjY0MyBDMTMuNzg1LDE4LjkzNSAxNC43NDUsMTkuOTg4IDE2LjAyOCwxOS45ODggQzE4LjM1MSwxOS45ODggMjAuMTM2LDE3LjU1NiAyMC4xMzYsMTQuMDQ2IEMyMC4xMzYsMTAuOTM5IDE3Ljg4OCw4Ljc2NyAxNC42NzgsOC43NjcgQzEwLjk1OSw4Ljc2NyA4Ljc3NywxMS41MzYgOC43NzcsMTQuMzk4IEM4Ljc3NywxNS41MTMgOS4yMSwxNi43MDkgOS43NDksMTcuMzU5IEM5Ljg1NiwxNy40ODggOS44NzIsMTcuNiA5Ljg0LDE3LjczMSBDOS43NDEsMTguMTQxIDkuNTIsMTkuMDIzIDkuNDc3LDE5LjIwMyBDOS40MiwxOS40NCA5LjI4OCwxOS40OTEgOS4wNCwxOS4zNzYgQzcuNDA4LDE4LjYyMiA2LjM4NywxNi4yNTIgNi4zODcsMTQuMzQ5IEM2LjM4NywxMC4yNTYgOS4zODMsNi40OTcgMTUuMDIyLDYuNDk3IEMxOS41NTUsNi40OTcgMjMuMDc4LDkuNzA1IDIzLjA3OCwxMy45OTEgQzIzLjA3OCwxOC40NjMgMjAuMjM5LDIyLjA2MiAxNi4yOTcsMjIuMDYyIEMxNC45NzMsMjIuMDYyIDEzLjcyOCwyMS4zNzkgMTMuMzAyLDIwLjU3MiBDMTMuMzAyLDIwLjU3MiAxMi42NDcsMjMuMDUgMTIuNDg4LDIzLjY1NyBDMTIuMTkzLDI0Ljc4NCAxMS4zOTYsMjYuMTk2IDEwLjg2MywyNy4wNTggQzEyLjA4NiwyNy40MzQgMTMuMzg2LDI3LjYzNyAxNC43MzMsMjcuNjM3IEMyMS45NSwyNy42MzcgMjcuODAxLDIxLjgyOCAyNy44MDEsMTQuNjYyIEMyNy44MDEsNy40OTUgMjEuOTUsMS42ODYgMTQuNzMzLDEuNjg2IiBmaWxsPSIjYmQwODFjIj48L3BhdGg+PC9nPjwvc3ZnPg==&quot;) 3px 50% / 14px 14px no-repeat rgb(189, 8, 28); position: absolute; opacity: 1; z-index: 8675309; display: none; cursor: pointer; border: none; -webkit-font-smoothing: antialiased;">저장</span><span style="border-radius: 3px; text-indent: 20px; width: 20px; height: 20px; background: url(&quot;data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHdpZHRoPSIzMHB4IiBoZWlnaHQ9IjMwcHgiIHZpZXdCb3g9IjAgMCAzMCAzMCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KPGc+CjxwYXRoIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLXdpZHRoPSI0IiBkPSJNMTcsMTcgTDIyLDIyIFogIi8+CjxjaXJjbGUgc3Ryb2tlPSIjZmZmIiBjeD0iMTMiIGN5PSIxMyIgcj0iNiIgZmlsbD0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIzLjUiLz4KPHBhdGggZmlsbD0iI2ZmZiIgZD0iTTAsMCBMOCwwIEw4LDMgTDMsMyBMMyw4IEwwLDggWiIvPgo8cGF0aCBmaWxsPSIjZmZmIiBkPSJNMzAsMjIgTDMwLDMwIEwyMiwzMCBMMjIsMjcgTDI3LDI3IEwyNywyMiBaIi8+CjxwYXRoIGZpbGw9IiNmZmYiIGQ9Ik0zMCwwIEwzMCw4IEwyNyw4IEwyNywzIEwyMiwzIEwyMiwwIFoiLz4KPHBhdGggZmlsbD0iI2ZmZiIgZD0iTTAsMjIgTDMsMjIgTDMsMjcgTDgsMjcgTDgsMzAgTDAsMzBaIi8+CjwvZz4KPC9zdmc+Cg==&quot;) 50% 50% / 14px 14px no-repeat rgba(0, 0, 0, 0.4); position: absolute; opacity: 1; z-index: 8675309; display: none; cursor: pointer; border: none;"></span></body></html>